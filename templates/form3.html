<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forms3</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Debug information -->
    <script>
        // Show debug info in console
        console.log("Form ID: {{ form_id }}");
        console.log("Self improvement data count: {{ self_improvement_data|length if self_improvement_data else 0 }}");
        console.log("Certification data count: {{ certification_data|length if certification_data else 0 }}");
        console.log("Copyright data count: {{ copyright_data|length if copyright_data else 0 }}");
        console.log("Resource data count: {{ resource_data|length if resource_data else 0 }}");
        console.log("Committee data count: {{ committee_data|length if committee_data else 0 }}");
        console.log("Project data count: {{ project_data|length if project_data else 0 }}");
        console.log("Contribution data count: {{ contribution_data|length if contribution_data else 0 }}");
        console.log("Self assessment marks: {{ self_assessment_marks }}");
    </script>
    <style>
        body {
            background: url('/static/bg.jpg') no-repeat center center fixed;
            background-size: cover;
            margin-bottom: 20px;
        }

        .acr-container,
        .teaching-process-container {
            margin-top: 150px;
        }

        .top-bar {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .top-bar a {
            margin-left: 15px;
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        .top-bar a:hover {
            text-decoration: underline;
        }

        .logo-link {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .logo-link img {
            width: 90px;
            height: auto;
        }

        .table-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 50px;
            padding: 20px;
            width: 100%; /* Ensure full width */
        }
    
        .table-box {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 1200px; /* Increase max-width for wider content */
            text-align: center;
            margin-bottom: 40px;
            transition: transform 0.3s ease-in-out;
        }

        .table-box:hover {
            transform: scale(1.02);
        }

        .table-title {
            margin-bottom: 20px;
            font-size: 24px;
            color: #00796b;
            transition: color 0.3s;
        }

        .table-title:hover {
            color: #004d40;
        }

        .total-box {
            margin-top: 20px;
            font-weight: bold;
            font-size: 18px;
            color: white;
            transition: color 0.3s;
        }

        /* Spacing between forms */
        .form-section {
            margin-bottom: 50px;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .self-assessment-container {
            margin-bottom: 20px;
            text-align: left;
        }

        .self-assessment-container label {
            font-weight: bold;
            color: #00796b;
        }

        /* Small input for 2-digit marks */
        .self-assessment-container input {
            width: 60px;
            display: inline-block;
        }

        .instructions {
            font-weight: bold;
            text-align: left;
            margin-left: 20px;
            font-size: 14px;
            line-height: 1.6;
            padding: 10px;
        }

        .total-box {
            margin-top: 20px;
            font-weight: bold;
            font-size: 18px;
            color: rgb(248, 254, 254);
            background-color: rgba(72, 69, 69, 0.7);
            padding: 10px;
            border-radius: 8px;
            transition: color 0.3s, background-color 0.3s;
        }

        .upload-download-buttons {
            display: none;
            margin-left: 20px;
        }
        .acr-container {
            background-color: #85ccc4; /* White background for ACR section */
            padding: 20px; /* Padding inside the ACR container */
            border-radius: 8px; /* Rounded corners */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Shadow for depth */
            margin-bottom: 20px; /* Space below the ACR section */
        }

    </style>
</head>

<body>
    <!-- Top Right Links -->
    <div class="top-bar">
       
        <a href="/logout">Logout</a>
    </div>

<!-- Logo -->
<a href="/landing" class="logo-link">
    <img src="/static/logo.png" alt="Logo">
</a>

<div class="table-container acr-container">
    <h3 class="table-title">Annual Confidential Report (ACR)</h3>
    <div class="instructions">
        <p>
            1. Standard editable templates are provided for both options. Please download the appropriate template and complete it as required.<br><br>
            2. You may modify the format and include additional information as necessary in the Word document. Ensure that all provided details are accurate and supported by valid documentation.<br><br>
            3. Once completed, upload the file in PDF format (file size must not exceed 1 MB).<br><br>
            4. The maximum score for each option is 10. At the end, the average of the scores from both options will be calculated, and the final marks will be awarded out of 10.
        </p>
    </div>

    <!-- Checkboxes for options -->
    <div class="checkboxes">
        <label>
            <input type="checkbox" id="selfImprovementInitiatives" onchange="toggleUploadDownload('selfImprovementInitiatives')"> Self-Improvement Initiatives
        </label>
        <label>
            <input type="checkbox" id="representingCollege" onchange="toggleUploadDownload('representingCollege')"> Representing College in External Environment
        </label>
    </div>

    <!-- Container for Self-Improvement Initiatives -->
    <div id="selfImprovementTableContainer" style="display: none;">
        <h4>Self-improvement initiatives/ certifications/Patents/Copyrights</h4>
        <table class="table table-bordered" id="selfImprovementTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Title of paper</th>
                    <th>Month/Year</th>
                    <th>Name of conference</th>
                    <th>ISBN/ISSN Number</th>
                    <th>Name of Co-authors</th>
                    <th>Online link</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if self_improvement_data and self_improvement_data|length > 0 %}
                    {% for item in self_improvement_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Title of paper" value="{{ item.1 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Month/Year" value="{{ item.2 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Name of conference" value="{{ item.3 }}"></td>
                        <td><input type="text" class="form-control" title="Enter ISBN/ISSN Number" value="{{ item.4 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Name of Co-authors" value="{{ item.5 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Online link" value="{{ item.6 }}"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'selfImprovementTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Title of paper"></td>
                        <td><input type="text" class="form-control" title="Enter Month/Year"></td>
                        <td><input type="text" class="form-control" title="Enter Name of conference"></td>
                        <td><input type="text" class="form-control" title="Enter ISBN/ISSN Number"></td>
                        <td><input type="text" class="form-control" title="Enter Name of Co-authors"></td>
                        <td><input type="text" class="form-control" title="Enter Online link"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'selfImprovementTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addSelfImprovementRow()">+</button>

        <!-- Certification table -->
        <h4>Certification</h4>
        <table class="table table-bordered" id="certificationTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Name of the Certification</th>
                    <th>Upload Document</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if certification_data and certification_data|length > 0 %}
                    {% for item in certification_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Name of the Certification" value="{{ item.1 }}"></td>
                        <td>
                            <div class="d-flex">
                                <input type="file" class="form-control" accept=".pdf,.doc,.docx">
                                {% if item.2 %}
                                <a href="/uploads/{{ item.2.split('/')[-1] }}" target="_blank" class="btn btn-info ml-2">View</a>
                                {% endif %}
                            </div>
                        </td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'certificationTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Name of the Certification"></td>
                        <td><input type="file" class="form-control" accept=".pdf,.doc,.docx"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'certificationTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addCertificationRow()">+</button>

        <!-- Copyright/Patent table -->
        <h4>Copyright/Patent</h4>
        <table class="table table-bordered" id="titleTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Name of the Title</th>
                    <th>Month/year</th>
                    <th>Registration Number</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if copyright_data and copyright_data|length > 0 %}
                    {% for item in copyright_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Name of the Title" value="{{ item.1 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Month/Year" value="{{ item.2 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Registration Number" value="{{ item.3 }}"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'titleTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Name of the Title"></td>
                        <td><input type="text" class="form-control" title="Enter Month/Year"></td>
                        <td><input type="text" class="form-control" title="Enter Registration Number"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'titleTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addTitleRow()">+</button>
    </div>

    <!-- Container for Representing College in External Environment -->
    <div id="representingCollegeTableContainer" style="display: none;">
        <!-- Table for Resource person in STTP/Training course/ Lecture Talks -->
        <h4>Resource person in STTP/Training course/ Lecture Talks</h4>
        <table class="table table-bordered" id="resourcePersonTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Topic Name</th>
                    <th>Department</th>
                    <th>Name of the institute</th>
                    <th>Number of participants</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if resource_data and resource_data|length > 0 %}
                    {% for item in resource_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Topic Name" value="{{ item.1 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Department" value="{{ item.2 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Name of the institute" value="{{ item.3 }}"></td>
                        <td><input type="number" class="form-control" title="Enter Number of participants" value="{{ item.4 }}"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'resourcePersonTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Topic Name"></td>
                        <td><input type="text" class="form-control" title="Enter Department"></td>
                        <td><input type="text" class="form-control" title="Enter Name of the institute"></td>
                        <td><input type="number" class="form-control" title="Enter Number of participants"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'resourcePersonTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addResourcePersonRow()">+</button>

        <!-- Table for Member of University Committee -->
        <h4>Member of University Committee</h4>
        <table class="table table-bordered" id="universityCommitteeTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Name of Committee</th>
                    <th>Roles and Responsibilities</th>
                    <th>Designation</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if committee_data and committee_data|length > 0 %}
                    {% for item in committee_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Name of Committee" value="{{ item.1 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Roles and Responsibilities" value="{{ item.2 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Designation" value="{{ item.3 }}"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'universityCommitteeTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Name of Committee"></td>
                        <td><input type="text" class="form-control" title="Enter Roles and Responsibilities"></td>
                        <td><input type="text" class="form-control" title="Enter Designation"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'universityCommitteeTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addUniversityCommitteeRow()">+</button>

        <!-- Table for External Projects -->
        <h4>External Projects / Task force / Exchange Programs</h4>
        <table class="table table-bordered" id="externalProjectsTable">
            <thead>
                <tr>
                    <th>Sr No.</th>
                    <th>Role</th>
                    <th>Description</th>
                    <th>Contribution</th>
                    <th>University</th>
                    <th>Duration</th>
                    <th>Comments</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if project_data and project_data|length > 0 %}
                    {% for item in project_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><input type="text" class="form-control" title="Enter Role" value="{{ item.1 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Description" value="{{ item.2 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Contribution" value="{{ item.3 }}"></td>
                        <td><input type="text" class="form-control" title="Enter University" value="{{ item.4 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Duration" value="{{ item.5 }}"></td>
                        <td><input type="text" class="form-control" title="Enter Comments" value="{{ item.6 }}"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'externalProjectsTable')">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="form-control" title="Enter Role"></td>
                        <td><input type="text" class="form-control" title="Enter Description"></td>
                        <td><input type="text" class="form-control" title="Enter Contribution"></td>
                        <td><input type="text" class="form-control" title="Enter University"></td>
                        <td><input type="text" class="form-control" title="Enter Duration"></td>
                        <td><input type="text" class="form-control" title="Enter Comments"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'externalProjectsTable')">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addExternalProjectsRow()">+</button>
    </div>

<!-- Self-Assessment Marks Input -->
<div class="self-assessment">
    <h4>Self-Assessment Marks</h4>
    <input type="number" class="form-control" id="selfAssessmentMarks" min="0" max="10" placeholder="Enter marks (0-10)" value="{{ self_assessment_marks if self_assessment_marks else '' }}">
    <small class="form-text text-muted">Please enter your self-assessment marks out of 10.</small>
</div>


</div>
    
      <!-- Contribution to Society Form -->
<div class="table-container teaching-process-container">
    <div class="table-box">
        <h3 class="table-title">Contribution to Society</h3>

        <div class="instructions">
            <p>
                1. The faculty member will earn 5 points per semester for different initiatives by AICTE (Induction programme, NSS activities,
                Unnat Bharat Abhiyaan, Yoga Classes, Blood donation, awareness activities for environment protection/ethics and other similar activities)
                having a direct impact on society.<br><br>
                2. The claim should be supported by an office order/ official communication from Head of Institute.
            </p>
        </div>

        <table class="table table-bordered" id="contributionTable">
            <thead>
                <tr>
                    <th>Sr. No.</th>
                    <th>Semester</th>
                    <th>Activity</th>
                    <th>Points</th>
                    <th>Order Copy</th>
                    <th>Upload Document</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if contribution_data and contribution_data|length > 0 %}
                    {% for item in contribution_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>
                            <select class="form-control" title="Select Semester">
                                <option value="">Select</option>
                                <option value="I" {% if item.1 == 'I' %}selected{% endif %}>I</option>
                                <option value="II" {% if item.1 == 'II' %}selected{% endif %}>II</option>
                                <option value="III" {% if item.1 == 'III' %}selected{% endif %}>III</option>
                                <option value="IV" {% if item.1 == 'IV' %}selected{% endif %}>IV</option>
                                <option value="V" {% if item.1 == 'V' %}selected{% endif %}>V</option>
                                <option value="VI" {% if item.1 == 'VI' %}selected{% endif %}>VI</option>
                                <option value="VII" {% if item.1 == 'VII' %}selected{% endif %}>VII</option>
                                <option value="VIII" {% if item.1 == 'VIII' %}selected{% endif %}>VIII</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control" title="Enter Activity" value="{{ item.2 }}"></td>
                        <td><input type="number" class="form-control contribution-points" title="Enter Points" min="0" max="5" value="{{ item.3 }}" oninput="calculateTeachingTotal()"></td>
                        <td><input type="text" class="form-control" title="Enter Order Copy" value="{{ item.4 }}"></td>
                        <td>
                            <div class="d-flex">
                                <input type="file" class="form-control" accept=".pdf,.doc,.docx">
                                {% if item.5 %}
                                <a href="/uploads/{{ item.5.split('/')[-1] }}" target="_blank" class="btn btn-info ml-2">View</a>
                                {% endif %}
                            </div>
                        </td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'contributionTable'); calculateTeachingTotal();">-</button></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>1</td>
                        <td>
                            <select class="form-control" required title="Select Semester">
                                <option value="">Select</option>
                                <option value="I">I</option>
                                <option value="II">II</option>
                                <option value="III">III</option>
                                <option value="IV">IV</option>
                                <option value="V">V</option>
                                <option value="VI">VI</option>
                                <option value="VII">VII</option>
                                <option value="VIII">VIII</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control" title="Enter Activity"></td>
                        <td><input type="number" class="form-control contribution-points" title="Enter Points" min="0" max="5" oninput="calculateTeachingTotal()"></td>
                        <td><input type="text" class="form-control" title="Enter Order Copy"></td>
                        <td><input type="file" class="form-control" accept=".pdf,.doc,.docx"></td>
                        <td><button class="btn btn-danger" onclick="removeRow(this, 'contributionTable'); calculateTeachingTotal();">-</button></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addContributionRow()">+</button>
    </div>
    <div class="total-box">
        Total Points: <span id="totalsocietyPoints">0</span>/10
    </div>
</div>  

<!-- Hidden element to store data counts -->
<div id="formData" 
     data-self-improvement-count="{{ self_improvement_data|length if self_improvement_data else 0 }}"
     data-certification-count="{{ certification_data|length if certification_data else 0 }}"
     data-copyright-count="{{ copyright_data|length if copyright_data else 0 }}"
     data-resource-count="{{ resource_data|length if resource_data else 0 }}"
     data-committee-count="{{ committee_data|length if committee_data else 0 }}"
     data-project-count="{{ project_data|length if project_data else 0 }}"
     data-contribution-count="{{ contribution_data|length if contribution_data else 0 }}"
     style="display: none;">
</div>

<input type="hidden" id="formId" value="{{ form_id }}">

    <!-- Reset and Next Buttons -->
    <div class="button-container">
        <input type="hidden" id="formId" value="{{ form_id }}">
        <button id="resetButton" class="btn btn-warning" onclick="resetAll()">Reset</button>
        <button id="saveButton" class="btn btn-primary" onclick="saveFormData()">Save</button>
        <button id="nextButton" class="btn btn-success" onclick="goToNext()">Proceed to Next Step</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const formId = "{{ form_id }}"; // Get form_id passed from the Flask route
        console.log("formId:", formId);
    </script>

    <script>
function toggleSelfImprovementTable() {
        const selfImprovementContainer = document.getElementById('selfImprovementTableContainer');
        selfImprovementContainer.style.display = selfImprovementContainer.style.display === 'none' ? 'block' : 'none';
    }

    function toggleRepresentingCollegeTable() {
        const representingCollegeContainer = document.getElementById('representingCollegeTableContainer');
        representingCollegeContainer.style.display = representingCollegeContainer.style.display === 'none' ? 'block' : 'none';
    }

    function removeRow(button, tableId) {
        const row = button.parentNode.parentNode;
        const table = document.getElementById(tableId);
        table.deleteRow(row.rowIndex);
    }

    function addSelfImprovementRow() {
        const table = document.getElementById('selfImprovementTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Title of paper"></td>
            <td><input type="text" class="form-control" title="Enter Month/Year"></td>
            <td><input type="text" class="form-control" title="Enter Name of conference"></td>
            <td><input type="text" class="form-control" title="Enter ISBN/ISSN Number"></td>
            <td><input type="text" class="form-control" title="Enter Name of Co-authors"></td>
            <td><input type="url" class="form-control" title="Enter Online link"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'selfImprovementTable')">-</button></td>
        `;
    }

    function addCertificationRow() {
        const table = document.getElementById('certificationTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Name of the Certification"></td>
            <td><input type="file" class="form-control" title="Upload Document"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'certificationTable')">-</button></td>
        `;
    }

    function addTitleRow() {
        const table = document.getElementById('titleTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Name of the Title"></td>
            <td><input type="text" class="form-control" title="Enter Month/Year"></td>
            <td><input type="text" class="form-control" title="Enter Registration Number"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'titleTable')">-</button></td>
        `;
    }

    function addResourcePersonRow() {
        const table = document.getElementById('resourcePersonTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Topic Name"></td>
            <td><input type="text" class="form-control" title="Enter Department"></td>
            <td><input type="text" class="form-control" title="Enter Name of the institute"></td>
            <td><input type="number" class="form-control" title="Enter Number of participants"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'resourcePersonTable')">-</button></td>
        `;
    }

    function addUniversityCommitteeRow() {
        const table = document.getElementById('universityCommitteeTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Name of Committee"></td>
            <td><input type="text" class="form-control" title="Enter Roles and Responsibilities"></td>
            <td><input type="text" class="form-control" title="Enter Designation"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'universityCommitteeTable')">-</button></td>
        `;
    }

    function addExternalProjectsRow() {
        const table = document.getElementById('externalProjectsTable');
        const rowCount = table.rows.length;
        const newRow = table.insertRow(rowCount);
        newRow.innerHTML = `
            <td>${rowCount }</td>
            <td><input type="text" class="form-control" title="Enter Role"></td>
            <td><input type="text" class="form-control" title="Enter Description"></td>
            <td><input type="text" class="form-control" title="Enter Contribution"></td>
            <td><input type="text" class="form-control" title="Enter University"></td>
            <td><input type="text" class="form-control" title="Enter Duration"></td>
            <td><input type="text" class="form-control" title="Enter Comments"></td>
            <td><button class="btn btn-danger" onclick="removeRow(this, 'externalProjectsTable')">-</button></td>
        `;
    }

function updateRowNumbers(tableId) {
    const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
    const rows = table.rows;
    for (let i = 0; i < rows.length; i++) {
        rows[i].cells[0].innerText = i + 1; // Update the Sr No. cell
    }
}


        // Add new row to Contribution to Society form
        function addContributionRow() {
            let table = document.getElementById("contributionTable");
            let row = table.insertRow();
            row.innerHTML = `
                <td>${table.rows.length -1 }</td>
                <td>
                            <select class="form-control" required title="Select Semester">
                                <option value="">Select</option>
                                <option value="I">I</option>
                                <option value="II">II</option>
                                <option value="III">III</option>
                                <option value="IV">IV</option>
                                <option value="V">V</option>
                                <option value="VI">VI</option>
                                <option value="VII">VII</option>
                                <option value="VIII">VIII</option>
                            </select>
                        </td>
                <td><input type="text" class="form-control" title="Enter Activity"></td>
                <td><input type="number" class="form-control contribution-points" title="Enter Points" min="0" max="5" oninput="calculateTeachingTotal();"></td>
                <td><input type="text" class="form-control" title="Enter Order Copy"></td>
                <td>
                        <input type="file" class="form-control-file" onchange="uploadDocument(this)"> <!-- Upload Document Input -->
                        <div class="upload-status"></div>
                    </td>
                <td><button class="btn btn-danger" onclick="removeRow(this, 'contributionTable')">-</button></td>
            `;
        }

        // Remove row from Contribution to Society form
        function removeRow(button, tableId) {
            let table = document.getElementById(tableId);
            table.deleteRow(button.parentNode.parentNode.rowIndex - 0);
            calculateTeachingTotal();
        }

        // Calculate the total points for Contribution to Society
        function calculateTeachingTotal() {
            let total = 0;
            const points = document.querySelectorAll('.contribution-points');
            
            points.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            
            // Cap at 10 points if needed
            total = Math.min(total, 10);
            
            // If total exceeds 10, adjust the last changed input
            if (total > 10) {
                // Find the currently focused or last changed input
                const activeInput = document.activeElement;
                if (activeInput && activeInput.classList.contains('contribution-points')) {
                    // Calculate how much we need to reduce this input
                    const currentValue = parseFloat(activeInput.value) || 0;
                    const excess = total - 10;
                    const newValue = Math.max(0, currentValue - excess);
                    
                    // Update the input value
                    activeInput.value = newValue;
                    
                    // Recalculate the total
                    total = 10;
                }
            }
            
            document.getElementById('totalsocietyPoints').textContent = total.toFixed(2);
        }

        // Toggle display of upload/download buttons
        function toggleUploadDownload(section) {
            console.log(`Toggling section: ${section}`);
            if (section === 'selfImprovementInitiatives') {
                const container = document.getElementById('selfImprovementTableContainer');
                const checkbox = document.getElementById('selfImprovementInitiatives');
                container.style.display = checkbox.checked ? 'block' : 'none';
            } else if (section === 'representingCollege') {
                const container = document.getElementById('representingCollegeTableContainer');
                const checkbox = document.getElementById('representingCollege');
                container.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // Reset all inputs
        function resetAll() {
            document.querySelectorAll('input').forEach(input => input.value = '');
            document.getElementById("totalsocietyPoints").textContent = "0";
        }

        // Save form data (you would implement backend integration here)----------------------------------------------------------------------------------------------------
      
        

    // Collect the form data from various tables dynamically
function saveFormData() {
    const formData = new FormData();

    // Collect form ID
    const formId = document.getElementById('formId').value;
    formData.append('formId', formId);
    
    console.log("Saving form data for form ID:", formId);
    console.log("Number of tables processed: " + document.querySelectorAll('table').length);

    // Filter out empty rows and collect Self Improvement table data
    const selfImprovementTable = document.getElementById('selfImprovementTable');
    if (selfImprovementTable) {
        const rows = selfImprovementTable.querySelectorAll('tbody tr');
        console.log("Self improvement rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const title = row.querySelector('input[title="Enter Title of paper"]')?.value;
            const monthYear = row.querySelector('input[title="Enter Month/Year"]')?.value;
            const conference = row.querySelector('input[title="Enter Name of conference"]')?.value;
            const isbn = row.querySelector('input[title="Enter ISBN/ISSN Number"]')?.value;
            const coAuthors = row.querySelector('input[title="Enter Name of Co-authors"]')?.value;
            const link = row.querySelector('input[title="Enter Online link"]')?.value;
            
            // Only add non-empty rows - check title only, other fields can be empty
            if (title && title.trim() !== '') {
                const entry = {
                    title: title,
                    monthYear: monthYear || '',
                    conference: conference || '',
                    isbn: isbn || '',
                    coAuthors: coAuthors || '',
                    link: link || ''
                };
                
                formData.append(`selfImprovement[${index}]`, JSON.stringify(entry));
                console.log(`Added self improvement entry ${index}:`, entry);
            }
        });
    }

    // Filter out empty rows and collect Certification table data
    const certificationTable = document.getElementById('certificationTable');
    if (certificationTable) {
        const rows = certificationTable.querySelectorAll('tbody tr');
        console.log("Certification rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const name = row.querySelector('input[title="Enter Name of the Certification"]')?.value;
            const fileInput = row.querySelector('input[type="file"]');
            
            // Only add non-empty rows
            if (name && name.trim() !== '') {
                const entry = {
                    name: name
                };
                
                formData.append(`certification[${index}]`, JSON.stringify(entry));
                console.log(`Added certification entry ${index}:`, entry);
                
                if (fileInput && fileInput.files.length > 0) {
                    formData.append(`certificationFile[${index}]`, fileInput.files[0]);
                    console.log(`Added certification file for entry ${index}`);
                }
            }
        });
    }

    // Filter out empty rows and collect Copyright/Patent table data
    const titleTable = document.getElementById('titleTable');
    if (titleTable) {
        const rows = titleTable.querySelectorAll('tbody tr');
        console.log("Copyright rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const name = row.querySelector('input[title="Enter Name of the Title"]')?.value;
            const monthYear = row.querySelector('input[title="Enter Month/Year"]')?.value;
            const registration = row.querySelector('input[title="Enter Registration Number"]')?.value;
            
            // Only add non-empty rows
            if (name && name.trim() !== '') {
                const entry = {
                    name: name,
                    monthYear: monthYear || '',
                    registration: registration || ''
                };
                
                formData.append(`title[${index}]`, JSON.stringify(entry));
                console.log(`Added copyright entry ${index}:`, entry);
            }
        });
    }

    // Filter out empty rows and collect Resource Person table data
    const resourcePersonTable = document.getElementById('resourcePersonTable');
    if (resourcePersonTable) {
        const rows = resourcePersonTable.querySelectorAll('tbody tr');
        console.log("Resource person rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const topic = row.querySelector('input[title="Enter Topic Name"]')?.value;
            const department = row.querySelector('input[title="Enter Department"]')?.value;
            const institute = row.querySelector('input[title="Enter Name of the institute"]')?.value;
            const participants = row.querySelector('input[title="Enter Number of participants"]')?.value;
            
            // Only add non-empty rows
            if (topic && topic.trim() !== '') {
                const entry = {
                    topic: topic,
                    department: department || '',
                    institute: institute || '',
                    participants: participants || '0'
                };
                
                formData.append(`resourcePerson[${index}]`, JSON.stringify(entry));
                console.log(`Added resource person entry ${index}:`, entry);
            }
        });
    }

    // Filter out empty rows and collect University Committee table data
    const universityCommitteeTable = document.getElementById('universityCommitteeTable');
    if (universityCommitteeTable) {
        const rows = universityCommitteeTable.querySelectorAll('tbody tr');
        console.log("Committee rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const committee = row.querySelector('input[title="Enter Name of Committee"]')?.value;
            const responsibilities = row.querySelector('input[title="Enter Roles and Responsibilities"]')?.value;
            const designation = row.querySelector('input[title="Enter Designation"]')?.value;
            
            // Only add non-empty rows
            if (committee && committee.trim() !== '') {
                const entry = {
                    committee: committee,
                    responsibilities: responsibilities || '',
                    designation: designation || ''
                };
                
                formData.append(`universityCommittee[${index}]`, JSON.stringify(entry));
                console.log(`Added university committee entry ${index}:`, entry);
            }
        });
    }

    // Filter out empty rows and collect External Projects table data
    const externalProjectsTable = document.getElementById('externalProjectsTable');
    if (externalProjectsTable) {
        const rows = externalProjectsTable.querySelectorAll('tbody tr');
        console.log("Projects rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const role = row.querySelector('input[title="Enter Role"]')?.value;
            const description = row.querySelector('input[title="Enter Description"]')?.value;
            const contribution = row.querySelector('input[title="Enter Contribution"]')?.value;
            const university = row.querySelector('input[title="Enter University"]')?.value;
            const duration = row.querySelector('input[title="Enter Duration"]')?.value;
            const comments = row.querySelector('input[title="Enter Comments"]')?.value;
            
            // Only add non-empty rows
            if (role && role.trim() !== '') {
                const entry = {
                    role: role,
                    description: description || '',
                    contribution: contribution || '',
                    university: university || '',
                    duration: duration || '',
                    comments: comments || ''
                };
                
                formData.append(`externalProjects[${index}]`, JSON.stringify(entry));
                console.log(`Added external project entry ${index}:`, entry);
            }
        });
    }

    // Filter out empty rows and collect Contribution to Society table data
    const contributionTable = document.getElementById('contributionTable');
    if (contributionTable) {
        const rows = contributionTable.querySelectorAll('tbody tr');
        console.log("Contribution rows found: " + rows.length);
        
        rows.forEach((row, index) => {
            const semester = row.querySelector('select[title="Select Semester"]')?.value;
            const activity = row.querySelector('input[title="Enter Activity"]')?.value;
            const points = row.querySelector('input[title="Enter Points"]')?.value;
            const orderCopy = row.querySelector('input[title="Enter Order Copy"]')?.value;
            const fileInput = row.querySelector('input[type="file"]');
            
            // Only add non-empty rows
            if (activity && activity.trim() !== '') {
                const entry = {
                    semester: semester || '',
                    activity: activity,
                    points: points || '0',
                    orderCopy: orderCopy || ''
                };
                
                formData.append(`contribution[${index}]`, JSON.stringify(entry));
                console.log(`Added contribution entry ${index}:`, entry);
                
                if (fileInput && fileInput.files.length > 0) {
                    formData.append(`contributionFile[${index}]`, fileInput.files[0]);
                    console.log(`Added contribution file for entry ${index}`);
                }
            }
        });
    }

    // Add self-assessment marks
    const selfAssessmentMarks = document.getElementById('selfAssessmentMarks').value;
    formData.append('selfAssessmentMarks', selfAssessmentMarks || '0');
    console.log("Self assessment marks:", selfAssessmentMarks);

    // Print total form entries to verify all data is included
    console.log("Total form entries: ", formData.getAll("formId").length);

    // Send the form data to the server
    console.log("Sending form data to server...");
    document.getElementById("saveButton").disabled = true;
    document.getElementById("saveButton").textContent = "Saving...";
    
    fetch('/save-form3-data', {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        console.log("Server response status:", response.status);
        return response.json();
    })
    .then(data => {
        document.getElementById("saveButton").disabled = false;
        document.getElementById("saveButton").textContent = "Save";
        
        if (data.status === 'success') {
            alert('Form data saved successfully');
            console.log("Save successful:", data);
        } else {
            alert('Error: ' + data.message);
            console.error("Save error:", data);
        }
    })
    .catch(error => {
        document.getElementById("saveButton").disabled = false;
        document.getElementById("saveButton").textContent = "Save";
        
        console.error('Error:', error);
        alert('Error saving form data: ' + error);
    });
}



// upload function 
function uploadDocument(input) {
    const file = input.files[0];
    const uploadStatus = input.nextElementSibling;

    if (!file) {
        alert("Please select a file to upload.");
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    fetch('/upload', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            uploadStatus.textContent = `Error: ${data.error}`;
            uploadStatus.style.color = 'red';
        } else {
            uploadStatus.textContent = `Uploaded: ${data.filename}`;
            uploadStatus.style.color = 'green';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        uploadStatus.textContent = 'Upload failed!';
        uploadStatus.style.color = 'red';
    });
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------

function goToNext() {
    // Fetch input value correctly
    let totalPoints = parseInt(document.getElementById('selfAssessmentMarks').value);
    let totalPointsObtained = parseInt(document.getElementById('totalsocietyPoints').innerText);

    console.log("Total acr Points: ", totalPoints);
    console.log("Total contribution to society Points: ", totalPointsObtained);

    // Ensure form ID is valid
    let formId = document.getElementById('formId').value;

    if (!formId || isNaN(totalPoints) || isNaN(totalPointsObtained)) {
        console.error("Invalid form ID or points.");
        alert("Error: Please ensure all form data is filled correctly.");
        return;
    }

    let overallTotal = totalPoints + totalPointsObtained;

    // Log the data being sent
    console.log(JSON.stringify({
        form_id: formId,
        total: overallTotal,
        acr: totalPoints,
        society: totalPointsObtained
    }));

    // Send AJAX request
    $.ajax({
        url: '/save-3total-points',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            form_id: formId,
            total: overallTotal,
            acr: totalPoints,
            society: totalPointsObtained
        }),
        success: function(response) {
            // Redirect to /review with form ID
            window.location.href = "/review/" + formId;
        },
        error: function(error) {
            console.error("Error saving total points:", error);
            alert("There was an error saving the total points. Please try again.");
        }
    });
}

// Document load event listener to initialize the form
document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM loaded, initializing form");
    
    // Initialize the table visibility based on checkboxes
    toggleUploadDownload('selfImprovementInitiatives');
    toggleUploadDownload('representingCollege');
    
    // Calculate initial totals for contribution table
    calculateTeachingTotal();
    
    // Get data counts from data attributes
    const selfImprovementDataCount = document.getElementById('formData').getAttribute('data-self-improvement-count');
    const certificationDataCount = document.getElementById('formData').getAttribute('data-certification-count');
    const copyrightDataCount = document.getElementById('formData').getAttribute('data-copyright-count');
    
    const resourceDataCount = document.getElementById('formData').getAttribute('data-resource-count');
    const committeeDataCount = document.getElementById('formData').getAttribute('data-committee-count');
    const projectDataCount = document.getElementById('formData').getAttribute('data-project-count');
    
    console.log("Data counts:", {
        selfImprovementDataCount,
        certificationDataCount,
        copyrightDataCount,
        resourceDataCount,
        committeeDataCount,
        projectDataCount
    });
    
    // Show self-improvement section if it has data
    if (parseInt(selfImprovementDataCount) > 0 || parseInt(certificationDataCount) > 0 || parseInt(copyrightDataCount) > 0) {
        console.log("Found self-improvement data, showing section");
        document.getElementById('selfImprovementInitiatives').checked = true;
        toggleUploadDownload('selfImprovementInitiatives');
    }
    
    // Show representing college section if it has data
    if (parseInt(resourceDataCount) > 0 || parseInt(committeeDataCount) > 0 || parseInt(projectDataCount) > 0) {
        console.log("Found representing college data, showing section");
        document.getElementById('representingCollege').checked = true;
        toggleUploadDownload('representingCollege');
    }
});

    </script>
</body>

</html>
